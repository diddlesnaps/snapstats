{
  "{\"sourceRoot\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src\",\"filename\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js\",\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src\",\"plugins\":[{\"key\":\"syntax-dynamic-import\",\"visitor\":{},\"options\":{}},{\"key\":\"transform-runtime\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"MemberExpression\":{\"enter\":[null],\"exit\":[null]},\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"useESModules\":true}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"loose\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"loose\":false}},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-async-generator-functions\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-json-strings\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-optional-catch-binding\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"CatchClause\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.5.5": {
    "metadata": {},
    "options": {
      "sourceRoot": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "filename": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js",
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-dynamic-import",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {}
        },
        {
          "key": "transform-runtime",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "BinaryExpression": {
              "enter": [
                null
              ]
            },
            "MemberExpression": {
              "enter": [
                null
              ],
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true,
            "Identifier": {
              "enter": [
                null
              ]
            },
            "JSXIdentifier": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "useESModules": true
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "loose": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "loose": false
          }
        },
        {
          "key": "transform-dotall-regex",
          "visitor": {
            "RegExpLiteral": {
              "enter": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-async-generator-functions",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-object-rest-spread",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "VariableDeclarator": {
              "enter": [
                null
              ]
            },
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            },
            "CatchClause": {
              "enter": [
                null
              ]
            },
            "AssignmentExpression": {
              "enter": [
                null
              ]
            },
            "ObjectExpression": {
              "enter": [
                null
              ]
            },
            "FunctionDeclaration": {
              "enter": [
                null
              ]
            },
            "FunctionExpression": {
              "enter": [
                null
              ]
            },
            "ObjectMethod": {
              "enter": [
                null
              ]
            },
            "ArrowFunctionExpression": {
              "enter": [
                null
              ]
            },
            "ClassMethod": {
              "enter": [
                null
              ]
            },
            "ClassPrivateMethod": {
              "enter": [
                null
              ]
            },
            "ForInStatement": {
              "enter": [
                null
              ]
            },
            "ForOfStatement": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-unicode-property-regex",
          "visitor": {
            "RegExpLiteral": {
              "enter": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-json-strings",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "DirectiveLiteral": {
              "enter": [
                null
              ]
            },
            "StringLiteral": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-optional-catch-binding",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "CatchClause": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-named-capturing-groups-regex",
          "visitor": {
            "RegExpLiteral": {
              "enter": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js",
        "plugins": [
          "dynamicImport",
          "dynamicImport",
          "asyncGenerators",
          "objectRestSpread",
          "jsonStrings",
          "optionalCatchBinding"
        ]
      },
      "generatorOpts": {
        "filename": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
        "sourceFileName": "server.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.dailyThinning = exports.dailyRatings = exports.hourlyStats = exports.graphql = exports.server = void 0;\n\nvar functions = _interopRequireWildcard(require(\"firebase-functions\"));\n\nvar _sirv = _interopRequireDefault(require(\"sirv\"));\n\nvar _compression = _interopRequireDefault(require(\"compression\"));\n\nvar sapper = _interopRequireWildcard(require(\"@sapper/server\"));\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _expressGraphql = _interopRequireDefault(require(\"express-graphql\"));\n\nvar _graphql = require(\"./graphql\");\n\nvar _collector = require(\"./collector\");\n\nconst {\n  PORT,\n  NODE_ENV\n} = process.env;\nconst dev = NODE_ENV === 'development';\nconst mongoUrl = process.env.MONGO_URL || functions.config().mongo.url || 'mongodb://localhost/snapstats'; // Connect to MongoDB with Mongoose.\n\n_mongoose.default.connect(mongoUrl, {\n  useCreateIndex: true,\n  useNewUrlParser: true,\n  reconnectTries: Number.MAX_VALUE,\n  reconnectInterval: 500,\n  connectTimeoutMS: 10000\n}).catch(err => console.log(`Mongo failed to connect: ${err.toString()}`));\n\nconst expressGraphQLServer = (0, _expressGraphql.default)({\n  schema: _graphql.schema,\n  graphiql: true\n});\nconst app = (0, _express.default)() // You can also use Express\n.use((0, _compression.default)({\n  threshold: 0\n}), (0, _sirv.default)('static', {\n  dev\n}));\n\nif (PORT) {\n  app.use('/graphql', expressGraphQLServer);\n  app.listen(PORT, err => {\n    if (err) console.log('error', err);\n  });\n}\n\napp.use(sapper.middleware());\nconst server = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB'\n}).https.onRequest(app);\nexports.server = server;\nconst graphql = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB'\n}).https.onRequest(expressGraphQLServer);\nexports.graphql = graphql;\nconst hourlyStats = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB'\n}).pubsub.schedule('every 4 hours').onRun((0, _collector.collectStats)(false)); // export const dailyStats = functions.pubsub.schedule('every 24 hours').onRun(collectStats(true));\n\nexports.hourlyStats = hourlyStats;\nconst dailyRatings = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '256MB'\n}).pubsub.schedule('every 24 hours').onRun(_collector.collectRatings);\nexports.dailyRatings = dailyRatings;\nconst dailyThinning = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB'\n}).pubsub.schedule('48 23 * * *').onRun(_collector.thinStats);\nexports.dailyThinning = dailyThinning;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJQT1JUIiwiTk9ERV9FTlYiLCJwcm9jZXNzIiwiZW52IiwiZGV2IiwibW9uZ29VcmwiLCJNT05HT19VUkwiLCJmdW5jdGlvbnMiLCJjb25maWciLCJtb25nbyIsInVybCIsIm1vbmdvb3NlIiwiY29ubmVjdCIsInVzZUNyZWF0ZUluZGV4IiwidXNlTmV3VXJsUGFyc2VyIiwicmVjb25uZWN0VHJpZXMiLCJOdW1iZXIiLCJNQVhfVkFMVUUiLCJyZWNvbm5lY3RJbnRlcnZhbCIsImNvbm5lY3RUaW1lb3V0TVMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ0b1N0cmluZyIsImV4cHJlc3NHcmFwaFFMU2VydmVyIiwic2NoZW1hIiwiZ3JhcGhpcWwiLCJhcHAiLCJ1c2UiLCJ0aHJlc2hvbGQiLCJsaXN0ZW4iLCJzYXBwZXIiLCJtaWRkbGV3YXJlIiwic2VydmVyIiwicnVuV2l0aCIsInRpbWVvdXRTZWNvbmRzIiwibWVtb3J5IiwiaHR0cHMiLCJvblJlcXVlc3QiLCJncmFwaHFsIiwiaG91cmx5U3RhdHMiLCJwdWJzdWIiLCJzY2hlZHVsZSIsIm9uUnVuIiwiZGFpbHlSYXRpbmdzIiwiY29sbGVjdFJhdGluZ3MiLCJkYWlseVRoaW5uaW5nIiwidGhpblN0YXRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUVBLE1BQU07QUFBRUEsRUFBQUEsSUFBRjtBQUFRQyxFQUFBQTtBQUFSLElBQXFCQyxPQUFPLENBQUNDLEdBQW5DO0FBQ0EsTUFBTUMsR0FBRyxHQUFHSCxRQUFRLEtBQUssYUFBekI7QUFFQSxNQUFNSSxRQUFRLEdBQUdILE9BQU8sQ0FBQ0MsR0FBUixDQUFZRyxTQUFaLElBQXlCQyxTQUFTLENBQUNDLE1BQVYsR0FBbUJDLEtBQW5CLENBQXlCQyxHQUFsRCxJQUF5RCwrQkFBMUUsQyxDQUNBOztBQUNBQyxrQkFDR0MsT0FESCxDQUVJUCxRQUZKLEVBR0k7QUFDRVEsRUFBQUEsY0FBYyxFQUFFLElBRGxCO0FBRUVDLEVBQUFBLGVBQWUsRUFBRSxJQUZuQjtBQUdFQyxFQUFBQSxjQUFjLEVBQUVDLE1BQU0sQ0FBQ0MsU0FIekI7QUFJRUMsRUFBQUEsaUJBQWlCLEVBQUUsR0FKckI7QUFLRUMsRUFBQUEsZ0JBQWdCLEVBQUU7QUFMcEIsQ0FISixFQVdHQyxLQVhILENBV1VDLEdBQUQsSUFBU0MsT0FBTyxDQUFDQyxHQUFSLENBQWEsNEJBQTJCRixHQUFHLENBQUNHLFFBQUosRUFBZSxFQUF2RCxDQVhsQjs7QUFhQSxNQUFNQyxvQkFBb0IsR0FBRyw2QkFBZTtBQUMxQ0MsRUFBQUEsTUFBTSxFQUFOQSxlQUQwQztBQUUxQ0MsRUFBQUEsUUFBUSxFQUFFO0FBRmdDLENBQWYsQ0FBN0I7QUFLQSxNQUFNQyxHQUFHLEdBQUcsd0JBQVU7QUFBVixDQUNWQyxHQURVLENBRVYsMEJBQVk7QUFBRUMsRUFBQUEsU0FBUyxFQUFFO0FBQWIsQ0FBWixDQUZVLEVBR1YsbUJBQUssUUFBTCxFQUFlO0FBQUUxQixFQUFBQTtBQUFGLENBQWYsQ0FIVSxDQUFaOztBQUtBLElBQUlKLElBQUosRUFBVTtBQUNSNEIsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsVUFBUixFQUFvQkosb0JBQXBCO0FBQ0RHLEVBQUFBLEdBQUcsQ0FBQ0csTUFBSixDQUFXL0IsSUFBWCxFQUFpQnFCLEdBQUcsSUFBSTtBQUN2QixRQUFJQSxHQUFKLEVBQVNDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVosRUFBcUJGLEdBQXJCO0FBQ1IsR0FGRjtBQUdBOztBQUVETyxHQUFHLENBQUNDLEdBQUosQ0FBUUcsTUFBTSxDQUFDQyxVQUFQLEVBQVI7QUFFTyxNQUFNQyxNQUFNLEdBQUczQixTQUFTLENBQUM0QixPQUFWLENBQWtCO0FBQ3RDQyxFQUFBQSxjQUFjLEVBQUUsRUFEc0I7QUFFdENDLEVBQUFBLE1BQU0sRUFBRTtBQUY4QixDQUFsQixFQUduQkMsS0FIbUIsQ0FHYkMsU0FIYSxDQUdIWCxHQUhHLENBQWY7O0FBS0EsTUFBTVksT0FBTyxHQUFHakMsU0FBUyxDQUFDNEIsT0FBVixDQUFrQjtBQUN2Q0MsRUFBQUEsY0FBYyxFQUFFLEVBRHVCO0FBRXZDQyxFQUFBQSxNQUFNLEVBQUU7QUFGK0IsQ0FBbEIsRUFHcEJDLEtBSG9CLENBR2RDLFNBSGMsQ0FHSmQsb0JBSEksQ0FBaEI7O0FBS0EsTUFBTWdCLFdBQVcsR0FBR2xDLFNBQVMsQ0FBQzRCLE9BQVYsQ0FBa0I7QUFDM0NDLEVBQUFBLGNBQWMsRUFBRSxHQUQyQjtBQUUzQ0MsRUFBQUEsTUFBTSxFQUFFO0FBRm1DLENBQWxCLEVBR3hCSyxNQUh3QixDQUdqQkMsUUFIaUIsQ0FHUixlQUhRLEVBR1NDLEtBSFQsQ0FHZSw2QkFBYSxLQUFiLENBSGYsQ0FBcEIsQyxDQUlQOzs7QUFDTyxNQUFNQyxZQUFZLEdBQUd0QyxTQUFTLENBQUM0QixPQUFWLENBQWtCO0FBQzVDQyxFQUFBQSxjQUFjLEVBQUUsRUFENEI7QUFFNUNDLEVBQUFBLE1BQU0sRUFBRTtBQUZvQyxDQUFsQixFQUd6QkssTUFIeUIsQ0FHbEJDLFFBSGtCLENBR1QsZ0JBSFMsRUFHU0MsS0FIVCxDQUdlRSx5QkFIZixDQUFyQjs7QUFJQSxNQUFNQyxhQUFhLEdBQUd4QyxTQUFTLENBQUM0QixPQUFWLENBQWtCO0FBQzdDQyxFQUFBQSxjQUFjLEVBQUUsR0FENkI7QUFFN0NDLEVBQUFBLE1BQU0sRUFBRTtBQUZxQyxDQUFsQixFQUcxQkssTUFIMEIsQ0FHbkJDLFFBSG1CLENBR1YsYUFIVSxFQUdLQyxLQUhMLENBR1dJLG9CQUhYLENBQXRCIiwic291cmNlUm9vdCI6Ii9ob21lL2RsbGV3ZWxseW4vRGV2ZWxvcG1lbnQvc25hcGNyYWZ0L3NuYXBzdGF0cy1zdmVsdGUvc3JjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnVuY3Rpb25zIGZyb20gJ2ZpcmViYXNlLWZ1bmN0aW9ucyc7XG5cbmltcG9ydCBzaXJ2IGZyb20gJ3NpcnYnO1xuaW1wb3J0IGNvbXByZXNzaW9uIGZyb20gJ2NvbXByZXNzaW9uJztcbmltcG9ydCAqIGFzIHNhcHBlciBmcm9tICdAc2FwcGVyL3NlcnZlcic7XG5pbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgZXhwcmVzc0dyYXBoUUwgZnJvbSBcImV4cHJlc3MtZ3JhcGhxbFwiO1xuXG5pbXBvcnQgeyBzY2hlbWEgfSBmcm9tIFwiLi9ncmFwaHFsXCI7XG5pbXBvcnQgeyBjb2xsZWN0U3RhdHMsIGNvbGxlY3RSYXRpbmdzLCB0aGluU3RhdHMgfSBmcm9tICcuL2NvbGxlY3Rvcic7XG5cbmNvbnN0IHsgUE9SVCwgTk9ERV9FTlYgfSA9IHByb2Nlc3MuZW52O1xuY29uc3QgZGV2ID0gTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XG5cbmNvbnN0IG1vbmdvVXJsID0gcHJvY2Vzcy5lbnYuTU9OR09fVVJMIHx8IGZ1bmN0aW9ucy5jb25maWcoKS5tb25nby51cmwgfHwgJ21vbmdvZGI6Ly9sb2NhbGhvc3Qvc25hcHN0YXRzJztcbi8vIENvbm5lY3QgdG8gTW9uZ29EQiB3aXRoIE1vbmdvb3NlLlxubW9uZ29vc2VcbiAgLmNvbm5lY3QoXG4gICAgbW9uZ29VcmwsXG4gICAge1xuICAgICAgdXNlQ3JlYXRlSW5kZXg6IHRydWUsXG4gICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXG4gICAgICByZWNvbm5lY3RUcmllczogTnVtYmVyLk1BWF9WQUxVRSxcbiAgICAgIHJlY29ubmVjdEludGVydmFsOiA1MDAsXG4gICAgICBjb25uZWN0VGltZW91dE1TOiAxMDAwMCxcbiAgICB9XG4gIClcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGBNb25nbyBmYWlsZWQgdG8gY29ubmVjdDogJHtlcnIudG9TdHJpbmcoKX1gKSk7XG5cbmNvbnN0IGV4cHJlc3NHcmFwaFFMU2VydmVyID0gZXhwcmVzc0dyYXBoUUwoe1xuICBzY2hlbWEsXG4gIGdyYXBoaXFsOiB0cnVlLFxufSk7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKSAvLyBZb3UgY2FuIGFsc28gdXNlIEV4cHJlc3Ncblx0LnVzZShcblx0XHRjb21wcmVzc2lvbih7IHRocmVzaG9sZDogMCB9KSxcblx0XHRzaXJ2KCdzdGF0aWMnLCB7IGRldiB9KSxcbiAgKVxuaWYgKFBPUlQpIHtcbiAgYXBwLnVzZSgnL2dyYXBocWwnLCBleHByZXNzR3JhcGhRTFNlcnZlcik7XG5cdGFwcC5saXN0ZW4oUE9SVCwgZXJyID0+IHtcblx0XHRpZiAoZXJyKSBjb25zb2xlLmxvZygnZXJyb3InLCBlcnIpO1xuICB9KTtcbn1cblxuYXBwLnVzZShzYXBwZXIubWlkZGxld2FyZSgpKTtcblxuZXhwb3J0IGNvbnN0IHNlcnZlciA9IGZ1bmN0aW9ucy5ydW5XaXRoKHtcbiAgdGltZW91dFNlY29uZHM6IDMwLFxuICBtZW1vcnk6ICcxMjhNQicsXG59KS5odHRwcy5vblJlcXVlc3QoYXBwKTtcblxuZXhwb3J0IGNvbnN0IGdyYXBocWwgPSBmdW5jdGlvbnMucnVuV2l0aCh7XG4gIHRpbWVvdXRTZWNvbmRzOiAzMCxcbiAgbWVtb3J5OiAnMTI4TUInLFxufSkuaHR0cHMub25SZXF1ZXN0KGV4cHJlc3NHcmFwaFFMU2VydmVyKTtcblxuZXhwb3J0IGNvbnN0IGhvdXJseVN0YXRzID0gZnVuY3Rpb25zLnJ1bldpdGgoe1xuICB0aW1lb3V0U2Vjb25kczogMzAwLFxuICBtZW1vcnk6ICcyNTZNQidcbn0pLnB1YnN1Yi5zY2hlZHVsZSgnZXZlcnkgNCBob3VycycpLm9uUnVuKGNvbGxlY3RTdGF0cyhmYWxzZSkpO1xuLy8gZXhwb3J0IGNvbnN0IGRhaWx5U3RhdHMgPSBmdW5jdGlvbnMucHVic3ViLnNjaGVkdWxlKCdldmVyeSAyNCBob3VycycpLm9uUnVuKGNvbGxlY3RTdGF0cyh0cnVlKSk7XG5leHBvcnQgY29uc3QgZGFpbHlSYXRpbmdzID0gZnVuY3Rpb25zLnJ1bldpdGgoe1xuICB0aW1lb3V0U2Vjb25kczogMzAsXG4gIG1lbW9yeTogJzI1Nk1CJyxcbn0pLnB1YnN1Yi5zY2hlZHVsZSgnZXZlcnkgMjQgaG91cnMnKS5vblJ1bihjb2xsZWN0UmF0aW5ncyk7XG5leHBvcnQgY29uc3QgZGFpbHlUaGlubmluZyA9IGZ1bmN0aW9ucy5ydW5XaXRoKHtcbiAgdGltZW91dFNlY29uZHM6IDMwMCxcbiAgbWVtb3J5OiAnMjU2TUInLFxufSkucHVic3ViLnNjaGVkdWxlKCc0OCAyMyAqICogKicpLm9uUnVuKHRoaW5TdGF0cyk7XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "PORT",
        "NODE_ENV",
        "process",
        "env",
        "dev",
        "mongoUrl",
        "MONGO_URL",
        "functions",
        "config",
        "mongo",
        "url",
        "mongoose",
        "connect",
        "useCreateIndex",
        "useNewUrlParser",
        "reconnectTries",
        "Number",
        "MAX_VALUE",
        "reconnectInterval",
        "connectTimeoutMS",
        "catch",
        "err",
        "console",
        "log",
        "toString",
        "expressGraphQLServer",
        "schema",
        "graphiql",
        "app",
        "use",
        "threshold",
        "listen",
        "sapper",
        "middleware",
        "server",
        "runWith",
        "timeoutSeconds",
        "memory",
        "https",
        "onRequest",
        "graphql",
        "hourlyStats",
        "pubsub",
        "schedule",
        "onRun",
        "dailyRatings",
        "collectRatings",
        "dailyThinning",
        "thinStats"
      ],
      "mappings": ";;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AAEA,MAAM;AAAEA,EAAAA,IAAF;AAAQC,EAAAA;AAAR,IAAqBC,OAAO,CAACC,GAAnC;AACA,MAAMC,GAAG,GAAGH,QAAQ,KAAK,aAAzB;AAEA,MAAMI,QAAQ,GAAGH,OAAO,CAACC,GAAR,CAAYG,SAAZ,IAAyBC,SAAS,CAACC,MAAV,GAAmBC,KAAnB,CAAyBC,GAAlD,IAAyD,+BAA1E,C,CACA;;AACAC,kBACGC,OADH,CAEIP,QAFJ,EAGI;AACEQ,EAAAA,cAAc,EAAE,IADlB;AAEEC,EAAAA,eAAe,EAAE,IAFnB;AAGEC,EAAAA,cAAc,EAAEC,MAAM,CAACC,SAHzB;AAIEC,EAAAA,iBAAiB,EAAE,GAJrB;AAKEC,EAAAA,gBAAgB,EAAE;AALpB,CAHJ,EAWGC,KAXH,CAWUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAa,4BAA2BF,GAAG,CAACG,QAAJ,EAAe,EAAvD,CAXlB;;AAaA,MAAMC,oBAAoB,GAAG,6BAAe;AAC1CC,EAAAA,MAAM,EAANA,eAD0C;AAE1CC,EAAAA,QAAQ,EAAE;AAFgC,CAAf,CAA7B;AAKA,MAAMC,GAAG,GAAG,wBAAU;AAAV,CACVC,GADU,CAEV,0BAAY;AAAEC,EAAAA,SAAS,EAAE;AAAb,CAAZ,CAFU,EAGV,mBAAK,QAAL,EAAe;AAAE1B,EAAAA;AAAF,CAAf,CAHU,CAAZ;;AAKA,IAAIJ,IAAJ,EAAU;AACR4B,EAAAA,GAAG,CAACC,GAAJ,CAAQ,UAAR,EAAoBJ,oBAApB;AACDG,EAAAA,GAAG,CAACG,MAAJ,CAAW/B,IAAX,EAAiBqB,GAAG,IAAI;AACvB,QAAIA,GAAJ,EAASC,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBF,GAArB;AACR,GAFF;AAGA;;AAEDO,GAAG,CAACC,GAAJ,CAAQG,MAAM,CAACC,UAAP,EAAR;AAEO,MAAMC,MAAM,GAAG3B,SAAS,CAAC4B,OAAV,CAAkB;AACtCC,EAAAA,cAAc,EAAE,EADsB;AAEtCC,EAAAA,MAAM,EAAE;AAF8B,CAAlB,EAGnBC,KAHmB,CAGbC,SAHa,CAGHX,GAHG,CAAf;;AAKA,MAAMY,OAAO,GAAGjC,SAAS,CAAC4B,OAAV,CAAkB;AACvCC,EAAAA,cAAc,EAAE,EADuB;AAEvCC,EAAAA,MAAM,EAAE;AAF+B,CAAlB,EAGpBC,KAHoB,CAGdC,SAHc,CAGJd,oBAHI,CAAhB;;AAKA,MAAMgB,WAAW,GAAGlC,SAAS,CAAC4B,OAAV,CAAkB;AAC3CC,EAAAA,cAAc,EAAE,GAD2B;AAE3CC,EAAAA,MAAM,EAAE;AAFmC,CAAlB,EAGxBK,MAHwB,CAGjBC,QAHiB,CAGR,eAHQ,EAGSC,KAHT,CAGe,6BAAa,KAAb,CAHf,CAApB,C,CAIP;;;AACO,MAAMC,YAAY,GAAGtC,SAAS,CAAC4B,OAAV,CAAkB;AAC5CC,EAAAA,cAAc,EAAE,EAD4B;AAE5CC,EAAAA,MAAM,EAAE;AAFoC,CAAlB,EAGzBK,MAHyB,CAGlBC,QAHkB,CAGT,gBAHS,EAGSC,KAHT,CAGeE,yBAHf,CAArB;;AAIA,MAAMC,aAAa,GAAGxC,SAAS,CAAC4B,OAAV,CAAkB;AAC7CC,EAAAA,cAAc,EAAE,GAD6B;AAE7CC,EAAAA,MAAM,EAAE;AAFqC,CAAlB,EAG1BK,MAH0B,CAGnBC,QAHmB,CAGV,aAHU,EAGKC,KAHL,CAGWI,oBAHX,CAAtB",
      "sourceRoot": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "sourcesContent": [
        "import * as functions from 'firebase-functions';\n\nimport sirv from 'sirv';\nimport compression from 'compression';\nimport * as sapper from '@sapper/server';\nimport mongoose from 'mongoose';\nimport express from 'express';\nimport expressGraphQL from \"express-graphql\";\n\nimport { schema } from \"./graphql\";\nimport { collectStats, collectRatings, thinStats } from './collector';\n\nconst { PORT, NODE_ENV } = process.env;\nconst dev = NODE_ENV === 'development';\n\nconst mongoUrl = process.env.MONGO_URL || functions.config().mongo.url || 'mongodb://localhost/snapstats';\n// Connect to MongoDB with Mongoose.\nmongoose\n  .connect(\n    mongoUrl,\n    {\n      useCreateIndex: true,\n      useNewUrlParser: true,\n      reconnectTries: Number.MAX_VALUE,\n      reconnectInterval: 500,\n      connectTimeoutMS: 10000,\n    }\n  )\n  .catch((err) => console.log(`Mongo failed to connect: ${err.toString()}`));\n\nconst expressGraphQLServer = expressGraphQL({\n  schema,\n  graphiql: true,\n});\n\nconst app = express() // You can also use Express\n\t.use(\n\t\tcompression({ threshold: 0 }),\n\t\tsirv('static', { dev }),\n  )\nif (PORT) {\n  app.use('/graphql', expressGraphQLServer);\n\tapp.listen(PORT, err => {\n\t\tif (err) console.log('error', err);\n  });\n}\n\napp.use(sapper.middleware());\n\nexport const server = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB',\n}).https.onRequest(app);\n\nexport const graphql = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB',\n}).https.onRequest(expressGraphQLServer);\n\nexport const hourlyStats = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB'\n}).pubsub.schedule('every 4 hours').onRun(collectStats(false));\n// export const dailyStats = functions.pubsub.schedule('every 24 hours').onRun(collectStats(true));\nexport const dailyRatings = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '256MB',\n}).pubsub.schedule('every 24 hours').onRun(collectRatings);\nexport const dailyThinning = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB',\n}).pubsub.schedule('48 23 * * *').onRun(thinStats);\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1565732458009
  },
  "{\"sourceRoot\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src\",\"filename\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js\",\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/dllewellyn/Development/snapcraft/snapstats-svelte/src\",\"plugins\":[{\"key\":\"syntax-dynamic-import\",\"visitor\":{},\"options\":{}},{\"key\":\"transform-runtime\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"MemberExpression\":{\"enter\":[null],\"exit\":[null]},\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"loose\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"loose\":false}},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-async-generator-functions\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-json-strings\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-optional-catch-binding\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"CatchClause\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.5.5": {
    "metadata": {},
    "options": {
      "sourceRoot": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "filename": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js",
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-dynamic-import",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {}
        },
        {
          "key": "transform-runtime",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "BinaryExpression": {
              "enter": [
                null
              ]
            },
            "MemberExpression": {
              "enter": [
                null
              ],
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true,
            "Identifier": {
              "enter": [
                null
              ]
            },
            "JSXIdentifier": {
              "enter": [
                null
              ]
            }
          },
          "options": {}
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "loose": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "loose": false
          }
        },
        {
          "key": "transform-dotall-regex",
          "visitor": {
            "RegExpLiteral": {
              "enter": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-async-generator-functions",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-object-rest-spread",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "VariableDeclarator": {
              "enter": [
                null
              ]
            },
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            },
            "CatchClause": {
              "enter": [
                null
              ]
            },
            "AssignmentExpression": {
              "enter": [
                null
              ]
            },
            "ObjectExpression": {
              "enter": [
                null
              ]
            },
            "FunctionDeclaration": {
              "enter": [
                null
              ]
            },
            "FunctionExpression": {
              "enter": [
                null
              ]
            },
            "ObjectMethod": {
              "enter": [
                null
              ]
            },
            "ArrowFunctionExpression": {
              "enter": [
                null
              ]
            },
            "ClassMethod": {
              "enter": [
                null
              ]
            },
            "ClassPrivateMethod": {
              "enter": [
                null
              ]
            },
            "ForInStatement": {
              "enter": [
                null
              ]
            },
            "ForOfStatement": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-unicode-property-regex",
          "visitor": {
            "RegExpLiteral": {
              "enter": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-json-strings",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "DirectiveLiteral": {
              "enter": [
                null
              ]
            },
            "StringLiteral": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-optional-catch-binding",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "CatchClause": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-named-capturing-groups-regex",
          "visitor": {
            "RegExpLiteral": {
              "enter": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js",
        "plugins": [
          "dynamicImport",
          "dynamicImport",
          "asyncGenerators",
          "objectRestSpread",
          "jsonStrings",
          "optionalCatchBinding"
        ]
      },
      "generatorOpts": {
        "filename": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src/server.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
        "sourceFileName": "server.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.dailyThinning = exports.dailyRatings = exports.hourlyStats = exports.graphql = exports.server = void 0;\n\nvar functions = _interopRequireWildcard(require(\"firebase-functions\"));\n\nvar _sirv = _interopRequireDefault(require(\"sirv\"));\n\nvar _compression = _interopRequireDefault(require(\"compression\"));\n\nvar sapper = _interopRequireWildcard(require(\"@sapper/server\"));\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _expressGraphql = _interopRequireDefault(require(\"express-graphql\"));\n\nvar _graphql = require(\"./graphql\");\n\nvar _collector = require(\"./collector\");\n\nconst {\n  PORT,\n  NODE_ENV\n} = process.env;\nconst dev = NODE_ENV === 'development';\nconst mongoUrl = process.env.MONGO_URL || functions.config().mongo.url || 'mongodb://localhost/snapstats'; // Connect to MongoDB with Mongoose.\n\n_mongoose.default.connect(mongoUrl, {\n  useCreateIndex: true,\n  useNewUrlParser: true,\n  reconnectTries: Number.MAX_VALUE,\n  reconnectInterval: 500,\n  connectTimeoutMS: 10000\n}).catch(err => console.log(`Mongo failed to connect: ${err.toString()}`));\n\nconst expressGraphQLServer = (0, _expressGraphql.default)({\n  schema: _graphql.schema,\n  graphiql: true\n});\nconst app = (0, _express.default)() // You can also use Express\n.use((0, _compression.default)({\n  threshold: 0\n}), (0, _sirv.default)('static', {\n  dev\n}));\n\nif (PORT) {\n  app.use('/graphql', expressGraphQLServer);\n  app.listen(PORT, err => {\n    if (err) console.log('error', err);\n  });\n}\n\napp.use(sapper.middleware());\nconst server = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB'\n}).https.onRequest(app);\nexports.server = server;\nconst graphql = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB'\n}).https.onRequest(expressGraphQLServer);\nexports.graphql = graphql;\nconst hourlyStats = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB'\n}).pubsub.schedule('every 4 hours').onRun((0, _collector.collectStats)(false)); // export const dailyStats = functions.pubsub.schedule('every 24 hours').onRun(collectStats(true));\n\nexports.hourlyStats = hourlyStats;\nconst dailyRatings = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '256MB'\n}).pubsub.schedule('every 24 hours').onRun(_collector.collectRatings);\nexports.dailyRatings = dailyRatings;\nconst dailyThinning = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB'\n}).pubsub.schedule('48 23 * * *').onRun(_collector.thinStats);\nexports.dailyThinning = dailyThinning;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJQT1JUIiwiTk9ERV9FTlYiLCJwcm9jZXNzIiwiZW52IiwiZGV2IiwibW9uZ29VcmwiLCJNT05HT19VUkwiLCJmdW5jdGlvbnMiLCJjb25maWciLCJtb25nbyIsInVybCIsIm1vbmdvb3NlIiwiY29ubmVjdCIsInVzZUNyZWF0ZUluZGV4IiwidXNlTmV3VXJsUGFyc2VyIiwicmVjb25uZWN0VHJpZXMiLCJOdW1iZXIiLCJNQVhfVkFMVUUiLCJyZWNvbm5lY3RJbnRlcnZhbCIsImNvbm5lY3RUaW1lb3V0TVMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ0b1N0cmluZyIsImV4cHJlc3NHcmFwaFFMU2VydmVyIiwic2NoZW1hIiwiZ3JhcGhpcWwiLCJhcHAiLCJ1c2UiLCJ0aHJlc2hvbGQiLCJsaXN0ZW4iLCJzYXBwZXIiLCJtaWRkbGV3YXJlIiwic2VydmVyIiwicnVuV2l0aCIsInRpbWVvdXRTZWNvbmRzIiwibWVtb3J5IiwiaHR0cHMiLCJvblJlcXVlc3QiLCJncmFwaHFsIiwiaG91cmx5U3RhdHMiLCJwdWJzdWIiLCJzY2hlZHVsZSIsIm9uUnVuIiwiZGFpbHlSYXRpbmdzIiwiY29sbGVjdFJhdGluZ3MiLCJkYWlseVRoaW5uaW5nIiwidGhpblN0YXRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUVBLE1BQU07QUFBRUEsRUFBQUEsSUFBRjtBQUFRQyxFQUFBQTtBQUFSLElBQXFCQyxPQUFPLENBQUNDLEdBQW5DO0FBQ0EsTUFBTUMsR0FBRyxHQUFHSCxRQUFRLEtBQUssYUFBekI7QUFFQSxNQUFNSSxRQUFRLEdBQUdILE9BQU8sQ0FBQ0MsR0FBUixDQUFZRyxTQUFaLElBQXlCQyxTQUFTLENBQUNDLE1BQVYsR0FBbUJDLEtBQW5CLENBQXlCQyxHQUFsRCxJQUF5RCwrQkFBMUUsQyxDQUNBOztBQUNBQyxrQkFDR0MsT0FESCxDQUVJUCxRQUZKLEVBR0k7QUFDRVEsRUFBQUEsY0FBYyxFQUFFLElBRGxCO0FBRUVDLEVBQUFBLGVBQWUsRUFBRSxJQUZuQjtBQUdFQyxFQUFBQSxjQUFjLEVBQUVDLE1BQU0sQ0FBQ0MsU0FIekI7QUFJRUMsRUFBQUEsaUJBQWlCLEVBQUUsR0FKckI7QUFLRUMsRUFBQUEsZ0JBQWdCLEVBQUU7QUFMcEIsQ0FISixFQVdHQyxLQVhILENBV1VDLEdBQUQsSUFBU0MsT0FBTyxDQUFDQyxHQUFSLENBQWEsNEJBQTJCRixHQUFHLENBQUNHLFFBQUosRUFBZSxFQUF2RCxDQVhsQjs7QUFhQSxNQUFNQyxvQkFBb0IsR0FBRyw2QkFBZTtBQUMxQ0MsRUFBQUEsTUFBTSxFQUFOQSxlQUQwQztBQUUxQ0MsRUFBQUEsUUFBUSxFQUFFO0FBRmdDLENBQWYsQ0FBN0I7QUFLQSxNQUFNQyxHQUFHLEdBQUcsd0JBQVU7QUFBVixDQUNWQyxHQURVLENBRVYsMEJBQVk7QUFBRUMsRUFBQUEsU0FBUyxFQUFFO0FBQWIsQ0FBWixDQUZVLEVBR1YsbUJBQUssUUFBTCxFQUFlO0FBQUUxQixFQUFBQTtBQUFGLENBQWYsQ0FIVSxDQUFaOztBQUtBLElBQUlKLElBQUosRUFBVTtBQUNSNEIsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsVUFBUixFQUFvQkosb0JBQXBCO0FBQ0RHLEVBQUFBLEdBQUcsQ0FBQ0csTUFBSixDQUFXL0IsSUFBWCxFQUFpQnFCLEdBQUcsSUFBSTtBQUN2QixRQUFJQSxHQUFKLEVBQVNDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVosRUFBcUJGLEdBQXJCO0FBQ1IsR0FGRjtBQUdBOztBQUVETyxHQUFHLENBQUNDLEdBQUosQ0FBUUcsTUFBTSxDQUFDQyxVQUFQLEVBQVI7QUFFTyxNQUFNQyxNQUFNLEdBQUczQixTQUFTLENBQUM0QixPQUFWLENBQWtCO0FBQ3RDQyxFQUFBQSxjQUFjLEVBQUUsRUFEc0I7QUFFdENDLEVBQUFBLE1BQU0sRUFBRTtBQUY4QixDQUFsQixFQUduQkMsS0FIbUIsQ0FHYkMsU0FIYSxDQUdIWCxHQUhHLENBQWY7O0FBS0EsTUFBTVksT0FBTyxHQUFHakMsU0FBUyxDQUFDNEIsT0FBVixDQUFrQjtBQUN2Q0MsRUFBQUEsY0FBYyxFQUFFLEVBRHVCO0FBRXZDQyxFQUFBQSxNQUFNLEVBQUU7QUFGK0IsQ0FBbEIsRUFHcEJDLEtBSG9CLENBR2RDLFNBSGMsQ0FHSmQsb0JBSEksQ0FBaEI7O0FBS0EsTUFBTWdCLFdBQVcsR0FBR2xDLFNBQVMsQ0FBQzRCLE9BQVYsQ0FBa0I7QUFDM0NDLEVBQUFBLGNBQWMsRUFBRSxHQUQyQjtBQUUzQ0MsRUFBQUEsTUFBTSxFQUFFO0FBRm1DLENBQWxCLEVBR3hCSyxNQUh3QixDQUdqQkMsUUFIaUIsQ0FHUixlQUhRLEVBR1NDLEtBSFQsQ0FHZSw2QkFBYSxLQUFiLENBSGYsQ0FBcEIsQyxDQUlQOzs7QUFDTyxNQUFNQyxZQUFZLEdBQUd0QyxTQUFTLENBQUM0QixPQUFWLENBQWtCO0FBQzVDQyxFQUFBQSxjQUFjLEVBQUUsRUFENEI7QUFFNUNDLEVBQUFBLE1BQU0sRUFBRTtBQUZvQyxDQUFsQixFQUd6QkssTUFIeUIsQ0FHbEJDLFFBSGtCLENBR1QsZ0JBSFMsRUFHU0MsS0FIVCxDQUdlRSx5QkFIZixDQUFyQjs7QUFJQSxNQUFNQyxhQUFhLEdBQUd4QyxTQUFTLENBQUM0QixPQUFWLENBQWtCO0FBQzdDQyxFQUFBQSxjQUFjLEVBQUUsR0FENkI7QUFFN0NDLEVBQUFBLE1BQU0sRUFBRTtBQUZxQyxDQUFsQixFQUcxQkssTUFIMEIsQ0FHbkJDLFFBSG1CLENBR1YsYUFIVSxFQUdLQyxLQUhMLENBR1dJLG9CQUhYLENBQXRCIiwic291cmNlUm9vdCI6Ii9ob21lL2RsbGV3ZWxseW4vRGV2ZWxvcG1lbnQvc25hcGNyYWZ0L3NuYXBzdGF0cy1zdmVsdGUvc3JjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnVuY3Rpb25zIGZyb20gJ2ZpcmViYXNlLWZ1bmN0aW9ucyc7XG5cbmltcG9ydCBzaXJ2IGZyb20gJ3NpcnYnO1xuaW1wb3J0IGNvbXByZXNzaW9uIGZyb20gJ2NvbXByZXNzaW9uJztcbmltcG9ydCAqIGFzIHNhcHBlciBmcm9tICdAc2FwcGVyL3NlcnZlcic7XG5pbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgZXhwcmVzc0dyYXBoUUwgZnJvbSBcImV4cHJlc3MtZ3JhcGhxbFwiO1xuXG5pbXBvcnQgeyBzY2hlbWEgfSBmcm9tIFwiLi9ncmFwaHFsXCI7XG5pbXBvcnQgeyBjb2xsZWN0U3RhdHMsIGNvbGxlY3RSYXRpbmdzLCB0aGluU3RhdHMgfSBmcm9tICcuL2NvbGxlY3Rvcic7XG5cbmNvbnN0IHsgUE9SVCwgTk9ERV9FTlYgfSA9IHByb2Nlc3MuZW52O1xuY29uc3QgZGV2ID0gTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XG5cbmNvbnN0IG1vbmdvVXJsID0gcHJvY2Vzcy5lbnYuTU9OR09fVVJMIHx8IGZ1bmN0aW9ucy5jb25maWcoKS5tb25nby51cmwgfHwgJ21vbmdvZGI6Ly9sb2NhbGhvc3Qvc25hcHN0YXRzJztcbi8vIENvbm5lY3QgdG8gTW9uZ29EQiB3aXRoIE1vbmdvb3NlLlxubW9uZ29vc2VcbiAgLmNvbm5lY3QoXG4gICAgbW9uZ29VcmwsXG4gICAge1xuICAgICAgdXNlQ3JlYXRlSW5kZXg6IHRydWUsXG4gICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXG4gICAgICByZWNvbm5lY3RUcmllczogTnVtYmVyLk1BWF9WQUxVRSxcbiAgICAgIHJlY29ubmVjdEludGVydmFsOiA1MDAsXG4gICAgICBjb25uZWN0VGltZW91dE1TOiAxMDAwMCxcbiAgICB9XG4gIClcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGBNb25nbyBmYWlsZWQgdG8gY29ubmVjdDogJHtlcnIudG9TdHJpbmcoKX1gKSk7XG5cbmNvbnN0IGV4cHJlc3NHcmFwaFFMU2VydmVyID0gZXhwcmVzc0dyYXBoUUwoe1xuICBzY2hlbWEsXG4gIGdyYXBoaXFsOiB0cnVlLFxufSk7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKSAvLyBZb3UgY2FuIGFsc28gdXNlIEV4cHJlc3Ncblx0LnVzZShcblx0XHRjb21wcmVzc2lvbih7IHRocmVzaG9sZDogMCB9KSxcblx0XHRzaXJ2KCdzdGF0aWMnLCB7IGRldiB9KSxcbiAgKVxuaWYgKFBPUlQpIHtcbiAgYXBwLnVzZSgnL2dyYXBocWwnLCBleHByZXNzR3JhcGhRTFNlcnZlcik7XG5cdGFwcC5saXN0ZW4oUE9SVCwgZXJyID0+IHtcblx0XHRpZiAoZXJyKSBjb25zb2xlLmxvZygnZXJyb3InLCBlcnIpO1xuICB9KTtcbn1cblxuYXBwLnVzZShzYXBwZXIubWlkZGxld2FyZSgpKTtcblxuZXhwb3J0IGNvbnN0IHNlcnZlciA9IGZ1bmN0aW9ucy5ydW5XaXRoKHtcbiAgdGltZW91dFNlY29uZHM6IDMwLFxuICBtZW1vcnk6ICcxMjhNQicsXG59KS5odHRwcy5vblJlcXVlc3QoYXBwKTtcblxuZXhwb3J0IGNvbnN0IGdyYXBocWwgPSBmdW5jdGlvbnMucnVuV2l0aCh7XG4gIHRpbWVvdXRTZWNvbmRzOiAzMCxcbiAgbWVtb3J5OiAnMTI4TUInLFxufSkuaHR0cHMub25SZXF1ZXN0KGV4cHJlc3NHcmFwaFFMU2VydmVyKTtcblxuZXhwb3J0IGNvbnN0IGhvdXJseVN0YXRzID0gZnVuY3Rpb25zLnJ1bldpdGgoe1xuICB0aW1lb3V0U2Vjb25kczogMzAwLFxuICBtZW1vcnk6ICcyNTZNQidcbn0pLnB1YnN1Yi5zY2hlZHVsZSgnZXZlcnkgNCBob3VycycpLm9uUnVuKGNvbGxlY3RTdGF0cyhmYWxzZSkpO1xuLy8gZXhwb3J0IGNvbnN0IGRhaWx5U3RhdHMgPSBmdW5jdGlvbnMucHVic3ViLnNjaGVkdWxlKCdldmVyeSAyNCBob3VycycpLm9uUnVuKGNvbGxlY3RTdGF0cyh0cnVlKSk7XG5leHBvcnQgY29uc3QgZGFpbHlSYXRpbmdzID0gZnVuY3Rpb25zLnJ1bldpdGgoe1xuICB0aW1lb3V0U2Vjb25kczogMzAsXG4gIG1lbW9yeTogJzI1Nk1CJyxcbn0pLnB1YnN1Yi5zY2hlZHVsZSgnZXZlcnkgMjQgaG91cnMnKS5vblJ1bihjb2xsZWN0UmF0aW5ncyk7XG5leHBvcnQgY29uc3QgZGFpbHlUaGlubmluZyA9IGZ1bmN0aW9ucy5ydW5XaXRoKHtcbiAgdGltZW91dFNlY29uZHM6IDMwMCxcbiAgbWVtb3J5OiAnMjU2TUInLFxufSkucHVic3ViLnNjaGVkdWxlKCc0OCAyMyAqICogKicpLm9uUnVuKHRoaW5TdGF0cyk7XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "PORT",
        "NODE_ENV",
        "process",
        "env",
        "dev",
        "mongoUrl",
        "MONGO_URL",
        "functions",
        "config",
        "mongo",
        "url",
        "mongoose",
        "connect",
        "useCreateIndex",
        "useNewUrlParser",
        "reconnectTries",
        "Number",
        "MAX_VALUE",
        "reconnectInterval",
        "connectTimeoutMS",
        "catch",
        "err",
        "console",
        "log",
        "toString",
        "expressGraphQLServer",
        "schema",
        "graphiql",
        "app",
        "use",
        "threshold",
        "listen",
        "sapper",
        "middleware",
        "server",
        "runWith",
        "timeoutSeconds",
        "memory",
        "https",
        "onRequest",
        "graphql",
        "hourlyStats",
        "pubsub",
        "schedule",
        "onRun",
        "dailyRatings",
        "collectRatings",
        "dailyThinning",
        "thinStats"
      ],
      "mappings": ";;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AAEA,MAAM;AAAEA,EAAAA,IAAF;AAAQC,EAAAA;AAAR,IAAqBC,OAAO,CAACC,GAAnC;AACA,MAAMC,GAAG,GAAGH,QAAQ,KAAK,aAAzB;AAEA,MAAMI,QAAQ,GAAGH,OAAO,CAACC,GAAR,CAAYG,SAAZ,IAAyBC,SAAS,CAACC,MAAV,GAAmBC,KAAnB,CAAyBC,GAAlD,IAAyD,+BAA1E,C,CACA;;AACAC,kBACGC,OADH,CAEIP,QAFJ,EAGI;AACEQ,EAAAA,cAAc,EAAE,IADlB;AAEEC,EAAAA,eAAe,EAAE,IAFnB;AAGEC,EAAAA,cAAc,EAAEC,MAAM,CAACC,SAHzB;AAIEC,EAAAA,iBAAiB,EAAE,GAJrB;AAKEC,EAAAA,gBAAgB,EAAE;AALpB,CAHJ,EAWGC,KAXH,CAWUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAa,4BAA2BF,GAAG,CAACG,QAAJ,EAAe,EAAvD,CAXlB;;AAaA,MAAMC,oBAAoB,GAAG,6BAAe;AAC1CC,EAAAA,MAAM,EAANA,eAD0C;AAE1CC,EAAAA,QAAQ,EAAE;AAFgC,CAAf,CAA7B;AAKA,MAAMC,GAAG,GAAG,wBAAU;AAAV,CACVC,GADU,CAEV,0BAAY;AAAEC,EAAAA,SAAS,EAAE;AAAb,CAAZ,CAFU,EAGV,mBAAK,QAAL,EAAe;AAAE1B,EAAAA;AAAF,CAAf,CAHU,CAAZ;;AAKA,IAAIJ,IAAJ,EAAU;AACR4B,EAAAA,GAAG,CAACC,GAAJ,CAAQ,UAAR,EAAoBJ,oBAApB;AACDG,EAAAA,GAAG,CAACG,MAAJ,CAAW/B,IAAX,EAAiBqB,GAAG,IAAI;AACvB,QAAIA,GAAJ,EAASC,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBF,GAArB;AACR,GAFF;AAGA;;AAEDO,GAAG,CAACC,GAAJ,CAAQG,MAAM,CAACC,UAAP,EAAR;AAEO,MAAMC,MAAM,GAAG3B,SAAS,CAAC4B,OAAV,CAAkB;AACtCC,EAAAA,cAAc,EAAE,EADsB;AAEtCC,EAAAA,MAAM,EAAE;AAF8B,CAAlB,EAGnBC,KAHmB,CAGbC,SAHa,CAGHX,GAHG,CAAf;;AAKA,MAAMY,OAAO,GAAGjC,SAAS,CAAC4B,OAAV,CAAkB;AACvCC,EAAAA,cAAc,EAAE,EADuB;AAEvCC,EAAAA,MAAM,EAAE;AAF+B,CAAlB,EAGpBC,KAHoB,CAGdC,SAHc,CAGJd,oBAHI,CAAhB;;AAKA,MAAMgB,WAAW,GAAGlC,SAAS,CAAC4B,OAAV,CAAkB;AAC3CC,EAAAA,cAAc,EAAE,GAD2B;AAE3CC,EAAAA,MAAM,EAAE;AAFmC,CAAlB,EAGxBK,MAHwB,CAGjBC,QAHiB,CAGR,eAHQ,EAGSC,KAHT,CAGe,6BAAa,KAAb,CAHf,CAApB,C,CAIP;;;AACO,MAAMC,YAAY,GAAGtC,SAAS,CAAC4B,OAAV,CAAkB;AAC5CC,EAAAA,cAAc,EAAE,EAD4B;AAE5CC,EAAAA,MAAM,EAAE;AAFoC,CAAlB,EAGzBK,MAHyB,CAGlBC,QAHkB,CAGT,gBAHS,EAGSC,KAHT,CAGeE,yBAHf,CAArB;;AAIA,MAAMC,aAAa,GAAGxC,SAAS,CAAC4B,OAAV,CAAkB;AAC7CC,EAAAA,cAAc,EAAE,GAD6B;AAE7CC,EAAAA,MAAM,EAAE;AAFqC,CAAlB,EAG1BK,MAH0B,CAGnBC,QAHmB,CAGV,aAHU,EAGKC,KAHL,CAGWI,oBAHX,CAAtB",
      "sourceRoot": "/home/dllewellyn/Development/snapcraft/snapstats-svelte/src",
      "sourcesContent": [
        "import * as functions from 'firebase-functions';\n\nimport sirv from 'sirv';\nimport compression from 'compression';\nimport * as sapper from '@sapper/server';\nimport mongoose from 'mongoose';\nimport express from 'express';\nimport expressGraphQL from \"express-graphql\";\n\nimport { schema } from \"./graphql\";\nimport { collectStats, collectRatings, thinStats } from './collector';\n\nconst { PORT, NODE_ENV } = process.env;\nconst dev = NODE_ENV === 'development';\n\nconst mongoUrl = process.env.MONGO_URL || functions.config().mongo.url || 'mongodb://localhost/snapstats';\n// Connect to MongoDB with Mongoose.\nmongoose\n  .connect(\n    mongoUrl,\n    {\n      useCreateIndex: true,\n      useNewUrlParser: true,\n      reconnectTries: Number.MAX_VALUE,\n      reconnectInterval: 500,\n      connectTimeoutMS: 10000,\n    }\n  )\n  .catch((err) => console.log(`Mongo failed to connect: ${err.toString()}`));\n\nconst expressGraphQLServer = expressGraphQL({\n  schema,\n  graphiql: true,\n});\n\nconst app = express() // You can also use Express\n\t.use(\n\t\tcompression({ threshold: 0 }),\n\t\tsirv('static', { dev }),\n  )\nif (PORT) {\n  app.use('/graphql', expressGraphQLServer);\n\tapp.listen(PORT, err => {\n\t\tif (err) console.log('error', err);\n  });\n}\n\napp.use(sapper.middleware());\n\nexport const server = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB',\n}).https.onRequest(app);\n\nexport const graphql = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '128MB',\n}).https.onRequest(expressGraphQLServer);\n\nexport const hourlyStats = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB'\n}).pubsub.schedule('every 4 hours').onRun(collectStats(false));\n// export const dailyStats = functions.pubsub.schedule('every 24 hours').onRun(collectStats(true));\nexport const dailyRatings = functions.runWith({\n  timeoutSeconds: 30,\n  memory: '256MB',\n}).pubsub.schedule('every 24 hours').onRun(collectRatings);\nexport const dailyThinning = functions.runWith({\n  timeoutSeconds: 300,\n  memory: '256MB',\n}).pubsub.schedule('48 23 * * *').onRun(thinStats);\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1565732458009
  }
}